При регистрации сервиса в `IServiceCollection` мы обязаны выбрать его время жизни. От этого зависит, будет ли создаваться новый объект каждый раз или использоваться старый.

### Основные методы регистрации
**AddTransient** (Транзиентный / Временный)
  Новый экземпляр создается *каждый раз*, когда он запрашивается
  Самый короткий цикл жизни. Не сохраняет состояние между вызовами
  
  *Применение:* Легковесные сервисы без состояния (stateless).
  *Поведение:* Если сервис внедряется в два разных класса в рамках одного запроса, это будут два *разных* объекта.


**AddScoped** (В рамках запроса)
  Экземпляр создается *один раз на один HTTP-запрос*
  Все компоненты (контроллеры, сервисы, middleware), участвующие в обработке одного конкретного запроса, получают один и тот же экземпляр. При завершении запроса экземпляр уничтожается (вызывается `Dispose`)
  
  *Применение:* Сервисы, работающие с данными текущего запроса (например, контекст БД, корзина пользователя).
  *Поведение:* Если в рамках одного запроса обратиться к сервису 10 раз — это будет один и тот же объект. Но для *другого* пользователя (другого запроса) создастся *новый*.


**AddSingleton** (Одиночка)
  Экземпляр создается **один раз** при первом обращении и живет до остановки приложения
  Все последующие запросы получают один и тот же экземпляр
  
  *Применение:* Кэш, конфигурация, сервисы, которые должны хранить общее состояние для всех пользователей.
  *Осторожно:* Нужно следить за потокобезопасностью (thread safety), так как к этому объекту могут обращаться тысячи пользователей одновременно

### Сводная таблица

| Метод         | Создание экземпляра           | Жизнь объекта               |
| :------------ | :---------------------------- | :-------------------------- |
| **Transient** | При каждом обращении          | Самый короткий              |
| **Scoped**    | Один раз на Клиентский Запрос | Пока идет обработка запроса |
| **Singleton** | Один раз на Запуск Приложения | Все время работы сервера    |

### Пример синтаксиса
```csharp
var builder = WebApplication.CreateBuilder(args);

// Transient: Каждый раз новый экземпляр
builder.Services.AddTransient<ITransientService, SomeService>();

// Scoped: Один экземпляр на запрос (БД)
builder.Services.AddScoped<IScopedService, SomeService>();

// Singleton: Один экземпляр на всё приложение (Кэш)
builder.Services.AddSingleton<ISingletonService, SomeService>();
```