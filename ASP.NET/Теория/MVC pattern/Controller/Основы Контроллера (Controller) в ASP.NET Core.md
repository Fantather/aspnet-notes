Контроллер — это центральный компонент в архитектуре MVC и Web API, отвечающий за обработку входящих HTTP-запросов, выполнение бизнес-логики (часто через сервисы) и формирование HTTP-ответов.


## Виды контроллеров
В ASP.NET Core есть два базовых класса для контроллеров.

**ControllerBase**
  Базовый класс для создания Web API.
  Предоставляет доступ к свойствам `HttpContext`, `Request`, `Response`, `User`.
  Содержит методы для возврата статус-кодов (`Ok()`, `NotFound()`, `BadRequest()`).
  *Рекомендуется* для REST API, так как он легковесный и не содержит методов для работы с Views.

**Controller**
  Наследуется от `ControllerBase`.
  Добавляет функционал для работы с представлениями (Razor Views).
  Имеет методы `View()`, `PartialView()` и свойства `ViewBag`, `ViewData`.
  Используется в классических MVC-приложениях с Server-Side Rendering.


## Атрибуты и Настройка
**[ApiController]**
  Этот атрибут не обязателен технически, но *крайне рекомендуется* для Web API. Он включает несколько важных механизмов, упрощающих код:
  1.  **Автоматическая валидация (400 Bad Request):** Тебе не нужно писать проверку `if (!ModelState.IsValid) return BadRequest();` в начале каждого метода. Если клиент прислал данные, не соответствующие модели (например, буквы вместо цифр или пропустил обязательное поле), ASP.NET Core сам прервет запрос и вернет ответ 400 с деталями ошибок.
  2.  **Умная привязка параметров (Inference):** Контроллер сам "догадывается", где искать данные:
      * Если параметр — это **класс** (сложный тип), он ищет его в **теле запроса** (Body). (Не нужно писать `[FromBody]`).
      * Если параметр — это **простой тип** (int, string, Guid), он ищет его в **URL** (Route или Query string).
  3.  **Требование маршрутов:** Заставляет использовать атрибутную маршрутизацию для всех методов (нельзя полагаться на соглашения, как в старом MVC), что делает API более предсказуемым.

**Маршрутизация [Route]**
  Задает *базовую часть* URL-адреса для всех методов внутри этого контроллера
  * **Шаблон `[Route("api/[controller]")]`:** Это стандарт де-факто.
      * `[controller]` — это специальный токен. При запуске он заменяется на имя класса контроллера *без* суффикса "Controller".
      * *Пример:* Класс `UsersController` превратится в путь `api/Users`.
      * *Пример:* Класс `CartController` превратится в путь `api/Cart`.
  * Это удобно: если ты переименуешь класс контроллера (через рефакторинг), URL обновится автоматически.


## Методы действия (Actions)
Публичные методы внутри контроллера называются **Actions** (действия). Каждый Action обрабатывает определенный HTTP-запрос.

**Особенности Actions**
  Должны быть `public`.
  Не могут быть `static`.
  Обычно возвращают `IActionResult` или `ActionResult<T>`.
  Если метод публичный, но не должен быть доступен извне, его помечают атрибутом `[NonAction]`.

**Асинхронность**
  Современный стандарт — использовать асинхронные методы (`async Task<IActionResult>`), чтобы не блокировать поток обработки запросов при ожидании базы данных или внешних сервисов.


## Пример структуры API контроллера
```csharp
using Microsoft.AspNetCore.Mvc;

namespace MyProject.Controllers
{
    [ApiController]
    [Route("api/[controller]")] // URL будет: api/Products
    public class ProductsController : ControllerBase
    {
        // GET: api/Products
        [HttpGet]
        public IActionResult GetAll()
        {
            return Ok(new[] { "Product1", "Product2" });
        }

        // Внутренний метод, недоступный по HTTP
        [NonAction]
        public void HelperMethod()
        {
            // Логика
        }
    }
}