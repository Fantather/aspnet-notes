Привязка модели (Model Binding) — это внутренний механизм ASP.NET Core, который автоматически сопоставляет данные из входящего HTTP-запроса с параметрами методов действия (Action methods) в контроллере. Это позволяет работать со строго типизированными объектами C#, скрывая низкоуровневую работу с объектом `HttpContext.Request`


## Основные источники данных по умолчанию
Если явно не указано иное, механизм привязки ищет данные для простых типов (числа, строки) в следующем порядке:

**1. Form values (Данные формы)**
  Значения, переданные в теле POST-запроса с типом содержимого `application/x-www-form-urlencoded` (стандартные HTML-формы)

**2. Route values (Данные маршрута)**
  Значения, извлеченные из URL-адреса на основе шаблона конечной точки (например, токен `{id}` в шаблоне `api/users/{id}`)

**3. Query string (Строка запроса)**
  Параметры, переданные в конце URL-адреса после знака вопроса (например, `?sort=name&page=2`)


## Явное указание источников (Атрибуты привязки)
Для точного контроля над тем, откуда брать данные, используются специальные атрибуты. Это *строго рекомендуется* применять в разработке Web API.

**[FromQuery]**
  Указывает привязчику искать значение исключительно в строке запроса URL
  *Часто используется для:* параметров фильтрации, сортировки и пагинации

**[FromRoute]**
  Указывает привязчику брать значение только из параметров маршрута
  *Часто используется для:* идентификаторов ресурсов, зашитых прямо в путь (например, id в `api/users/{id}`)

**[FromForm]**
  Указывает на необходимость извлечения данных из отправленной HTML-формы
  *Часто используется для:* загрузки файлов (`IFormFile`) или приема классических форм с веб-страниц

**[FromBody]**
  Указывает, что значение нужно десериализовать из тела запроса (обычно из формата JSON)
  *Часто используется для:* приема сложных объектов (DTO). Важно помнить, что в параметрах одного метода может быть только один такой атрибут, так как поток тела запроса можно прочитать лишь единожды

**[FromHeader]**
  Используется для прямого извлечения значений из HTTP-заголовков запроса
  *Часто используется для:* получения кастомных токенов, информации о User-Agent или языковых предпочтениях клиента

**[FromServices]**
  Указывает, что значение нужно взять не из HTTP-запроса, а запросить у контейнера внедрения зависимостей (DI)
  *Часто используется для:* сервисов, которые требуются только в одном конкретном методе, чтобы не засорять конструктор контроллера

## Особенности привязки сложных типов

**Сложные типы (Complex types)**
  Если параметром выступает пользовательский класс (DTO или ViewModel), привязчик создает его экземпляр через конструктор по умолчанию. Затем он перебирает все публичные свойства этого класса и ищет в запросе данные с совпадающими именами (без учета регистра).

**Коллекции**
  Механизм автоматически привязывает массивы и списки (например, `int[]` или `List<string>`). В URL это обычно передается путем дублирования ключей: `?tags=csharp&tags=dotnet`.

**Ошибки привязки и ModelState**
  Если привязчику не удается конвертировать данные (например, в строке запроса переданы буквы для типа `int`), приложение не падает с исключением. Ошибка конвертации регистрируется во встроенном словаре `ModelState`. Состояние привязки проверяется через свойство `ModelState.IsValid`.
  При использовании атрибута `[ApiController]` проверка `ModelState.IsValid` выполняется фреймворком автоматически, возвращая статус 400 Bad Request при наличии ошибок.

## Пример реализации в коде

```csharp
using Microsoft.AspNetCore.Mvc;

namespace MyProject.Controllers
{
    [ApiController]
    [Route("api/[controller]")]
    public class UsersController : ControllerBase
    {
        // GET: api/users/15?details=true
        [HttpGet("{id}")]
        public IActionResult GetUser(
            [FromRoute] int id, 
            [FromQuery] bool details, 
            [FromHeader(Name = "User-Agent")] string userAgent)
        {
            // Значения свойств:
            // id = 15
            // details = true
            // userAgent = строка из заголовков запроса браузера

            return Ok();
        }

        // POST: api/users
        [HttpPost]
        public IActionResult CreateUser([FromBody] CreateUserDto userDto)
        {
            // Объект userDto автоматически собран на основе JSON из тела запроса
            
            return Ok();
        }
    }
}
```


