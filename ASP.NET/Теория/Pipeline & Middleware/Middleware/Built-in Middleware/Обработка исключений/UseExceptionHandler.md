**UseExceptionHandler** — это встроенное промежуточное ПО (Middleware) для глобальной обработки исключений в промышленных (Production) средах. Оно позволяет перехватывать ошибки и перенаправлять поток выполнения на специализированный маршрут для формирования "дружелюбного" ответа клиенту.

## Основные характеристики
**Назначение**
  Централизованная обработка необработанных исключений без раскрытия чувствительных технических данных (стек вызовов, структура кода) конечному пользователю.

**Механизм работы**
  1. Middleware перехватывает исключение.
  2. Сбрасывает текущий ответ (очищает заголовки и тело, если ответ еще не начал отправляться).
  3. *Повторно выполняет* (Re-executes) запрос по указанному пути (например, `/error`), используя альтернативный конвейер.

**Контекст ошибки**
  Внутри обработчика ошибки (endpoint, на который происходит перенаправление) можно получить доступ к исходному исключению через интерфейс `IExceptionHandlerPathFeature` или `IExceptionHandlerFeature`.

## Правила использования

**Окружение**
  Применяется преимущественно в среде *Production* (или `!IsDevelopment()`). В среде разработки обычно заменяется на `UseDeveloperExceptionPage`.

**Порядок регистрации**
  Должен быть зарегистрирован одним из первых в методе конфигурации, чтобы покрывать исключения, возникающие в последующих middleware (например, в Routing, Authentication или пользовательских endpoint-ах).

**Ограничения**
  Не может обработать исключения, если заголовки ответа уже были отправлены клиенту. В этом случае соединение просто закрывается.

## Пример реализации
```csharp
var builder = WebApplication.CreateBuilder(args);
var app = builder.Build();

if (!app.Environment.IsDevelopment())
{
    // При возникновении исключения запрос будет перенаправлен на /error
    app.UseExceptionHandler("/error");
}

// Определение маршрута для обработки ошибок
app.Map("/error", errorApp =>
{
    errorApp.Run(async context =>
    {
        // Извлечение информации об исходном исключении
        var exceptionHandlerFeature = context.Features.Get<IExceptionHandlerPathFeature>();
        
        await context.Response.WriteAsync($"Error handled. Path: {exceptionHandlerFeature?.Path}");
    });
});

app.Run();
````

## Отличия UseExceptionHandler vs UseDeveloperExceptionPage

**Поток выполнения**
_UseDeveloperExceptionPage_: Генерирует ответ непосредственно в месте возникновения ошибки.

_UseExceptionHandler_: Изменяет путь запроса и повторно запускает конвейер для генерации альтернативного ответа.

**Целевая аудитория**
_UseDeveloperExceptionPage_: Разработчики (нужен Stack Trace)

_UseExceptionHandler_: Конечные пользователи (нужно понятное сообщение без технических деталей)