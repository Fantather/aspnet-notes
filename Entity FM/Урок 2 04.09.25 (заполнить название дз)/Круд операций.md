[[Entity FM/Урок 5(заполнить название дз)/код урока]]
[[DB SET]]
[[Code First]]
### 1. `Add`

![[Pasted image 20250904194448.png]]

```c#
User user1 = new User { Name = "Tom", Email = "lala@gmail.com", Age = 15 };
db.Users.Add(user1);
db.SaveChanges();

```
- Добавляет **один объект** в таблицу.
    
- Пока не вызван `SaveChanges()`, изменения **не сохраняются** в базе.
    
- После `SaveChanges()` объект получает свой `Id` (если он автогенерируется).



### 2. `AddRange`
```c#
List<User> users = new List<User>
{
    new User { Name = "Tom", Email = "lala@gmail.com", Age = 15 },
    new User { Name = "Maria", Email = "40@gmail.com", Age = 25 }
};

db.Users.AddRange(users);
db.SaveChanges();
```
- Добавляет сразу **несколько объектов** за один раз.
    
- Экономит время, если нужно добавить много данных.

```c#
using (TestUserDbContext db = new TestUserDbContext())
{
    var users = new List<User>
    {
        new User { Name = "Tom", Email = "lala@gmail.com", Age = 15 },
        new User { Name = "Maria", Email = "40@gmail.com", Age = 25 }
    };

    db.Users.AddRange(users); // добавляем сразу двух пользователей
    db.SaveChanges();         // сохраняем изменения в базе
}

```

### 3 .`Remove` и `RemoveRange`

```C#
// Удаляем один объект 
db.Users.Remove(user1); 
db.SaveChanges();  
// Удаляем несколько объектов 
db.Users.RemoveRange(users); 
db.SaveChanges();
```

- `Remove` — один объект
    
- `RemoveRange` — список объектов
    

---

### 4 `Update` и `UpdateRange`

```c#
user1.Name = "Tommy"; db.Users.Update(user1); db.SaveChanges();  // Обновляем несколько объектов
db.Users.UpdateRange(users); db.SaveChanges();
```

- Обновляет существующие записи.
    
- EF понимает, по какому `Id` нужно найти объект в базе.
    
![[Pasted image 20250904195120.png]]
---

### 5 `SaveChanges()`

- **Обязательный шаг**, иначе добавленные/изменённые/удалённые объекты **не попадут в базу**.
    
- Обычно делают в конце блока `using` или после нескольких операций для экономии ресурсов.

|Метод|Что делает|Принимает|Сохраняет сразу?|
|---|---|---|---|
|`Add`|Добавляет один объект|Один объект|Нет, нужно `SaveChanges()`|
|`AddRange`|Добавляет несколько объектов|Список объектов|Нет, нужно `SaveChanges()`|
|`Remove`|Удаляет один объект|Один объект|Нет, нужно `SaveChanges()`|
|`RemoveRange`|Удаляет несколько объектов|Список объектов|Нет, нужно `SaveChanges()`|
|`Update`|Обновляет один объект|Один объект|Нет, нужно `SaveChanges()`|
|`UpdateRange`|Обновляет несколько объектов|Список объектов|Нет, нужно `SaveChanges()`|
- Пока не вызван `SaveChanges()`, изменения **не сохраняются** в базе.
___
Считывание с базы данных

![[Pasted image 20250904194654.png]]

## Методы для чтения данных

Entity Framework позволяет **читать данные** разными способами:

### 1) `ToList()`

```c#
var users = db.Users.ToList();
```

- Возвращает **все записи** таблицы в виде списка.
    

---

### 2) `First()` / `FirstOrDefault()`

```c#
var user = db.Users.First(u => u.Name == "Tom");          // выбросит исключение, если нет 
var userSafe = db.Users.FirstOrDefault(u => u.Name == "Tom"); // вернёт null, если нет
```
- Ищет **первую запись**, удовлетворяющую условию.
    
![[Pasted image 20250904194904.png]]

---

### 3) `Single()` / `SingleOrDefault()`

```c#
var user = db.Users.Single(u => u.Email == "lala@gmail.com"); // исключение, если >1 
var userSafe = db.Users.SingleOrDefault(u => u.Email == "lala@gmail.com"); // null, если нет
```

- Используется, когда **ожидается ровно один объект**.
    

---

### 4) `Where()`

```c#
var youngUsers = db.Users.Where(u => u.Age < 20).ToList();
```

- Возвращает **коллекцию объектов**, соответствующих условию.
    

---

### 5) `OrderBy()` / `OrderByDescending()`

```c#
var sortedUsers = db.Users.OrderBy(u => u.Name).ToList(); 
var sortedDesc = db.Users.OrderByDescending(u => u.Age).ToList();
```

- Сортирует результаты по указанному полю.
    

---

### 6) `Count()`

```c#
int count = db.Users.Count();// всех пользователей 

int teens = db.Users.Count(u => u.Age < 20); // только до 20 лет
```

- Считает количество записей **всех или удовлетворяющих условию**.

___
#резюме 
## Таблица методов Entity Framework

| Категория                    | Метод                               | Описание                                        | Пример                                                                              |
| ---------------------------- | ----------------------------------- | ----------------------------------------------- | ----------------------------------------------------------------------------------- |
| **Добавление**               | `Add`                               | Добавляет один объект                           | `db.Users.Add(user1); db.SaveChanges();`                                            |
|                              | `AddRange`                          | Добавляет несколько объектов                    | `db.Users.AddRange(users); db.SaveChanges();`                                       |
| **Удаление**                 | `Remove`                            | Удаляет один объект                             | `db.Users.Remove(user1); db.SaveChanges();`                                         |
|                              | `RemoveRange`                       | Удаляет несколько объектов                      | `db.Users.RemoveRange(users); db.SaveChanges();`                                    |
| **Обновление**               | `Update`                            | Обновляет один объект                           | `db.Users.Update(user1); db.SaveChanges();`                                         |
|                              | `UpdateRange`                       | Обновляет несколько объектов                    | `db.Users.UpdateRange(users); db.SaveChanges();`                                    |
| **Чтение**                   | `ToList()`                          | Получает все записи или результат запроса       | `var all = db.Users.ToList();`                                                      |
|                              | `First()` / `FirstOrDefault()`      | Берёт первый объект, либо null                  | `var user = db.Users.FirstOrDefault(u => u.Age < 20);`                              |
|                              | `Single()` / `SingleOrDefault()`    | Берёт ровно один объект, иначе исключение/null  | `var user = db.Users.SingleOrDefault(u => u.Email == "lala@gmail.com");`            |
|                              | `Where()`                           | Фильтрует коллекцию                             | `var teens = db.Users.Where(u => u.Age < 20).ToList();`                             |
|                              | `OrderBy()` / `OrderByDescending()` | Сортировка                                      | `var sorted = db.Users.OrderBy(u => u.Name).ToList();`                              |
|                              | `Count()`                           | Подсчёт записей                                 | `int total = db.Users.Count();`  <br>`int teens = db.Users.Count(u => u.Age < 20);` |
| **Комбинированные операции** | LINQ методы                         | Можно комбинировать фильтр, сортировку, подсчёт | `var result = db.Users.Where(u => u.Age < 20).OrderBy(u => u.Name).ToList();`       |
