## **Ручное добавление через контекст**

Простейший способ — создавать объекты и сохранять через [[DbContext]].
```c#
using (var context = new AppDbContext())
{
    // Создаём объекты
    var customer = new Customer { Name = "Olga" };
    var product = new Product { Name = "Laptop", Price = 1200 };
    
    context.Customers.Add(customer);
    context.Products.Add(product);

    // Сохраняем в БД
    context.SaveChanges();
}
```
- [[Entity FM/Урок 5(заполнить название дз)/Круд операций#^add|Add]] добавляет объект в **контекст**, а `SaveChanges` — **фиксирует изменения в базе**.
    
- Можно добавлять **[[Entity FM/Урок 5(заполнить название дз)/Круд операций#2. `AddRange` addRange|несколько объектов одновременно]]**:
```c#
context.Products.AddRange(
    new Product { Name = "Phone", Price = 500 },
    new Product { Name = "Tablet", Price = 700 }
);
context.SaveChanges();
```

## **Seed Data через Fluent API**

- EF Core позволяет **настраивать начальные данные при миграции** через метод `OnModelCreating`.
```c#
protected override void OnModelCreating(ModelBuilder modelBuilder)
{
    modelBuilder.Entity<Customer>().HasData(
        new Customer { Id = 1, Name = "Olga" },
        new Customer { Id = 2, Name = "Alex" }
    );

    modelBuilder.Entity<Product>().HasData(
        new Product { Id = 1, Name = "Laptop", Price = 1200 },
        new Product { Id = 2, Name = "Phone", Price = 500 }
    );
}

```
- **Важно:** обязательно указывать `Id`, иначе EF Core не сможет отслеживать объекты.
    
- Данные будут автоматически добавлены при **применении миграций**:
```bash
dotnet ef migrations add SeedInitialData
dotnet ef database update
```

## **Использование метода Initialize/Seed**

Можно создать **специальный метод**, который заполняет БД при старте приложения.
```c#
public static class DbInitializer
{
    public static void Initialize(AppDbContext context)
    {
        context.Database.EnsureCreated(); // Создаёт БД, если нет

        if (!context.Customers.Any())
        {
            var customers = new[]
            {
                new Customer { Name = "Olga" },
                new Customer { Name = "Alex" }
            };
            context.Customers.AddRange(customers);
            context.SaveChanges();
        }

        if (!context.Products.Any())
        {
            context.Products.AddRange(
                new Product { Name = "Laptop", Price = 1200 },
                new Product { Name = "Phone", Price = 500 }
            );
            context.SaveChanges();
        }
    }
}
```
- Вызываем в `Program.cs` 
```c#
using(var scope = app.Services.CreateScope())
{
    var context = scope.ServiceProvider.GetRequiredService<AppDbContext>();
    DbInitializer.Initialize(context);
}

```
![[Pasted image 20250911200158.png]]
- Такой подход удобен для **тестовой и начальной базы**.
___
## **Массовое заполнение случайными данными**

- Для тестирования удобно использовать **циклы** или библиотеки вроде [Bogus](https://github.com/bchavez/Bogus) для генерации фейковых данных:
```c#
var faker = new Bogus.Faker<Product>()
    .RuleFor(p => p.Name, f => f.Commerce.ProductName())
    .RuleFor(p => p.Price, f => f.Random.Decimal(100, 2000));

var products = faker.Generate(50);
context.Products.AddRange(products);
context.SaveChanges();

```

#резюме 

|Способ|Когда использовать|Особенности|
|---|---|---|
|Ручное `Add`/`AddRange`|Малое количество данных, тесты|Простое, но не удобно для больших данных|
|Seed через `OnModelCreating`|Начальная база при миграции|Автоматически добавляется при `Update`|
|Метод `DbInitializer`|Тестовые данные, приложение в разработке|Можно добавить проверки на существование|
|Массовое заполнение/Bogus|Генерация больших объёмов тестовых данных|Быстро, удобно для нагрузочного тестирования|
