
- **Lazy Loading** — это когда связанные сущности подгружаются **только при первом обращении к ним**, а не вместе с основной сущностью.
    
- Противоположность — **жадная загрузка (Eager Loading)** с `Include`, когда данные подгружаются сразу.
    
- Полезно, когда не всегда нужно использовать связанные данные, чтобы экономить ресурсы.

```c#
class Order
{
    public int Id { get; set; }
    public Customer Customer { get; set; }
    public ICollection<OrderItem> OrderItems { get; set; }
}

class Customer
{
    public int Id { get; set; }
    public string Name { get; set; }
}

```
## **Пример ленивой загрузки**
```C#
var order = context.Orders.First();  // подгружает только заказ

var customerName = order.Customer.Name; // здесь EF сделает отдельный запрос к таблице Customers

```

- **Что происходит:**
    
    1. Сначала выполняется SQL-запрос для `Orders`.
        
    2. При обращении к `order.Customer` EF выполняет **второй SQL-запрос** для получения Customer.
        
- Если коллекция `OrderItems` не нужна, она не будет загружена.

___
## **Как включить Lazy Loading в EF Core**

1. Установить пакет:
    

```bash
Install-Package Microsoft.EntityFrameworkCore.Proxies
```

2. Настроить контекст:
    

```c#
protected override void OnConfiguring(DbContextOptionsBuilder optionsBuilder) {     
optionsBuilder         
.UseLazyLoadingProxies()         
.UseSqlServer("your_connection_string"); }
```

3. Сделать навигационные свойства **виртуальными**:
    

```c#
public virtual Customer Customer { get; set; } 
public virtual ICollection<OrderItem> 
OrderItems { get; set; }
```

- Это нужно, чтобы EF мог создать прокси для перехвата обращения к свойству.
    

---

## **Плюсы и минусы**

### **Плюсы:**

- Загружается **только то, что реально нужно**.
    
- Меньше памяти при работе с большим количеством сущностей.
    

### **Минусы:**

- Может вызвать **N+1 проблему**, если данные запрашиваются в цикле:
    

```c#
foreach (var order in context.Orders) 
{     
Console.WriteLine(order.Customer.Name); // для каждого заказа отдельный запрос 
}
```

- Иногда медленнее, чем жадная загрузка с [[Entity FM/Урок 5(заполнить название дз)/Запросы/Include]].