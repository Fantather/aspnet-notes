## Разрешение DNS (Поиск адреса)

Прежде чем отправить запрос, клиенту нужно узнать IP-адрес сервера. Браузер (или клиент) не понимает человеческие имена вроде `google.com`, ему нужны цифры (например, `142.250.185.78`).

1. **Проверка кэша:**
    
    - **Браузер:** Проверяет свой локальный кэш DNS.
        
    - **ОС:** Если в браузере нет, проверяется файл `hosts` и кэш операционной системы.
        
    - **Роутер:** Запрос уходит на роутер.
        
2. **Запрос к DNS-серверу:** Если адрес не найден локально, запрос отправляется провайдеру (ISP) или публичному DNS (например, 8.8.8.8).
    
3. **Рекурсивный поиск:** Если DNS-сервер не знает адреса, он опрашивает корневые серверы -> серверы доменной зоны (.com) -> авторитетные серверы домена, пока не получит IP.
    

> **Итог этапа:** Клиент получил IP-адрес сервера (Destination IP).

---

## Установка соединения (TCP Handshake)

HTTP работает поверх протокола TCP (Transmission Control Protocol), который гарантирует доставку данных.

![Изображение: TCP 3-way handshake diagram](https://encrypted-tbn0.gstatic.com/licensed-image?q=tbn:ANd9GcRLCSTcHjZV9pol0EywqS21L97zOIZAtsxeUHNsSOagcmQbZJrvrVFrXBbYd3X8EkyxfO-5nP1e3m25AhULwnxbCDWIsDAnUs1ZcwUJFDzalUrJSPQ)


Клиент и сервер должны «договориться» о начале связи. Это называется **"Тройное рукопожатие" (3-way handshake)**:

1. **SYN (Synchronize):** Клиент отправляет пакет серверу, запрашивая соединение.
    
2. **SYN-ACK (Synchronize-Acknowledge):** Сервер подтверждает получение и готовность.
    
3. **ACK (Acknowledge):** Клиент подтверждает готовность сервера.
    

_Примечание:_ Если используется **HTTPS** (защищенное соединение), после TCP происходит еще и **TLS Handshake** (обмен сертификатами и генерация ключей шифрования).

---

## Отправка HTTP-запроса

Теперь, когда "труба" проложена, клиент формирует и отправляет само сообщение HTTP.

Структура отправляемого пакета:

- **Start Line (Стартовая строка):** Метод (`GET`, `POST`) + Путь (`/index.html`) + Версия протокола (`HTTP/1.1`).
    
- **Headers (Заголовки):** Метаданные (какой браузер, какие куки, какой формат данных ожидается).
    
    - Пример: `Host: example.com`, `User-Agent: Mozilla/5.0`.
        
- **Empty Line:** Разделитель.
    
- **Body (Тело):** Данные (только для `POST`, `PUT`, `PATCH`). В `GET` запросе тело обычно пустое.
    

---

## Обработка запроса на сервере

Сервер получает пакеты, собирает их и начинает обработку.

1. **Web Server (Веб-сервер):** Программы вроде **Nginx**, **Apache** или **IIS** принимают запрос. Они проверяют безопасность, перенаправления и статические файлы.
    
2. **Application Server (Сервер приложений):** Если запрос требует логики (например, C# .NET, Node.js, PHP), веб-сервер передает его приложению.
    
    - Код выполняет логику (контроллеры, сервисы).
        
    - Делаются запросы в Базу Данных (SQL/NoSQL), если нужно.
        
3. **Формирование ответа:** Сервер собирает результат (HTML-страницу, JSON-объект или файл).
    

---

## Отправка HTTP-ответа

Сервер отправляет данные обратно клиенту.

Структура ответа:

- **Status Line:** Версия протокола + Код состояния + Пояснение.
    
    - Пример: `HTTP/1.1 200 OK` (успех) или `404 Not Found` (не найдено).
        
- **Headers:** Тип контента, длина, настройки кэширования, серверные куки (`Set-Cookie`).
    
    - Пример: `Content-Type: application/json`.
        
- **Body:** Сами данные (HTML-код, картинка, JSON).
    

---

## Завершение соединения

В зависимости от заголовка `Connection`:

- **close:** Соединение разрывается после ответа (TCP termination).
    
- **keep-alive:** Соединение остается открытым для загрузки других ресурсов (картинок, стилей), чтобы не тратить время на новое "рукопожатие".
    

---

## Рендеринг (Для браузера)

Если клиентом был браузер, процесс продолжается:

1. Браузер читает HTML.
    
2. Находит ссылки на CSS, JS, картинки.
    
3. Отправляет **новые HTTP-запросы** для каждого из этих ресурсов (повторяя цикл).
    
4. Строит DOM-дерево и отрисовывает страницу пользователю.