Браузер, перед тем как показать вам запрашиваемую страницу, выполняет большое количество различных действий. Самое важное здесь понять, что **браузер не работает с HTML-страницей напрямую как с текстом, а строит для этого DOM**.

DOM – это объектная модель документа (Document Object Model). Представляет она собой древовидную структуру страницы, состоящую из узлов. Каждый узел в ней – это объект, который может иметь определённые свойства и методы. Иными словами, можно сказать, что DOM – это набор иерархически связанных между собой объектов.

![[Pasted image 20251205222228.png]]

Зачем браузер строит DOM? В основном это связано с тем, что прочитанный HTML-код ему нужно как-то представить в памяти и было решено, что оптимально это будет сделать в виде древовидной структуры. После того как браузер построил DOM, он его использует в дальнейших процессах, конечной целью которых является построения отображения этой страницы на экране.

Процесс перевода HTML-кода страницы в DOM выполняет парсер. При этом он это делает даже если HTML-код содержит ошибки, но так как он в данном случае это «понимает».

При этом DOM не является статической структурой. **Её можно изменять с помощью JavaScript и тут же видеть эти изменения на экране.** Для этого браузер нам предоставляет API. То есть благодаря DOM, мы можем с помощью JavaScript изменять содержимое страницы на лету. Таким образом, JavaScript – это ключевая технология для создания динамических веб-сайтов и веб-приложений. Без неё, каким-то других способом это сделать невозможно.

Перед тем как перейти к изучению DOM, рассмотрим сначала все основные этапы работ, которые браузер выполняет для преобразования исходного кода HTML-документа в отображение стилизованной и интерактивной картинки на экране. Кстати, этот процесс называется Critical Rendering Path (CRP).

**Шаги CRP:**
![[Pasted image 20251205222258.png]]

Хотя этот процесс состоит из большого количества шагов, их грубо можно представить в виде двух:

1. Анализирует HTML-документ, чтобы определить то, что в конечном итоге нужно отобразить на странице;
2. Выполняет отрисовку того что нужно отобразить.

Результатом первого этапа является формирование дерева рендеринга (_render tree_). Данное дерево содержит видимые элементы и текст, которые нужно отобразить на странице, и также связанные с ними стили. Это дерево дублирует структуру DOM, но включает как мы отметили выше только видимые элементы. В _render tree_ каждый элемент содержит соответствующий ему объект DOM и рассчитанные для него стили. Таким образом, _render tree_ описывает визуальное представление DOM.

Чтобы построить дерево рендеринга, браузеру нужны две вещи:

- DOM, который он формирует из полученного HTML-кода;
- CSSOM (CSS Object Model), который он строит из загруженных и распознанных стилей.

На втором этапе браузер выполняет отрисовку _render tree_. Для этого он:

- рассчитывает положение и размеры каждого элемента в _render tree_, этот шаг называется Layout;
- выполняет рисование, этот шаг называется Paint.

После Paint все нарисованные элементы находятся на одном слое. Для повышения производительности страницы браузер выполняет ещё один шаг, который называется Composite. В нем он группирует элементы по композиционным слоям. Именно благодаря этому этапу мы можем создать на странице плавную анимацию элементов при использовании таких свойств как `transform`, `opacity`. Так как изменение этих свойств вызовет только одну задачу Composite.

Для работы со слоями в Chrome есть отличный инструмент `Layers`.

![[Pasted image 20251205222324.png]]

Например, изменения свойства `color` вызовет сначала задачу Paint, а затем вероятнее всего последует Composite всех затронутых элементов.

Изменение `width` вызовет следующие задачи: Layout -> Paint -> Composite.

Layout и Paint – это ресурсоемкие процессы, поэтому для хорошей отзывчивости вашей страницы или веб-приложения, необходимо свести к минимуму операции которые их вызывают.

Список свойств, изменение которых вызывают Paint:

- `color`;
- `background`;
- `visibility`;
- `border-style` и другие.

Список свойств, изменение которых вызывает Layout:

- `width` и `height`;
- `padding` и `margin`;
- `display`;
- `border`;
- `top`, `left`, `right` и `bottom`;
- `position`;
- `font-size` и другие.

Кроме этого, Layout срабатывает не только при изменении CSS-свойств, но также, например когда мы хотим получить смещение элемента (`el.offsetLeft`, `el.offsetTop` и так далее) или его положение (`el.clientLeft`, `el.clientTop` и так далее), а также во многих других случаях. Более подробно ознакомиться с этими операциями можно [здесь](https://gist.github.com/paulirish/5d52fb081b3570c81e3a).

Чтобы понимать какую стоимость имеет то или иное свойство, можно установить [расширение css-triggers](https://marketplace.visualstudio.com/items?itemName=kisstkondoros.csstriggers) для [редактора кода VS Code](https://itchief.ru/javascript/vscode-setup):
![[Pasted image 20251205222353.png]]
